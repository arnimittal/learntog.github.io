<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Connect and Learn together</title>

    <!-- Basic SEO metadata -->
    <meta property="description" content=""/>
    <meta property="keywords" content=""/>
    <meta name="copyright" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0"/>


    <meta property="og:url" content="http://www.your-domain.com/your-page.html"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="Your Website Title"/>
    <meta property="og:description" content="Your description"/>
    <meta property="og:image" content="http://www.your-domain.com/path/image.jpg"/>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.6.0/fullcalendar.css'/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--<link rel="stylesheet" href="calendar.css"/>-->


    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.1/moment.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.6.0/fullcalendar.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>

    <!--<script src="../js/data.js"></script>-->
    <script src="../js/analytics.js"></script>

    <script>

        function toggleload() {
            $("#calendar").toggleClass("opaque");
        }


        var getdata = {
            a: 1234,
            setfacebook: function (uid, data) {
                if (typeof data == 'string') {
                    localStorage.setItem(uid + "facebook_friends", data);
                } else {
                    localStorage.setItem(uid + "facebook_friends", JSON.stringify(data));

                }
            },
            getfacebook: function (uid) {
                if (localStorage.getItem(uid + "facebook_friends") != null) {
                    return JSON.parse(localStorage.getItem(uid + "facebook_friends"));
                } else {
                    var starCountRef = firebase.database().ref('users/' + uid + '/facebook_friends/');
                    starCountRef.once('value').then(function (snapshot) {

                        var friends = snapshot.val();
                        getdata.setfacebook(uid, friends);
                        return friends;

                    });
                }
            },

            getdatafromdb: function (uid, property) {
                if (property == 'classes') {
                    //////console.log("in");
                    var starCountRef = firebase.database().ref('users/' + uid + '/classes/');
                    starCountRef.once('value').then(function (snapshot) {

                        var classes = snapshot.val();
                        //console.log("fetching from database");
                        if (classes != null || classes != undefined) {
                            getdata.setproperty(uid, classes, property);
                            timetablesur = classes;
//                            drawoncalendar(timetablesur, "my");
                            location.reload();
                        } else {
                            alert("Contact us.. quote (that impossible null returned from getdatafromdb)");
                            return null;

                        }
                    });
//
                }
                if (property == 'idtofid') {

                }
            },


            isaproperty: function (uid, property) {
                return localStorage.getItem(uid + property) == null || localStorage.getItem(uid + property) == "";
            },
            getproperty: function (uid, property) {
                //console.log(localStorage.getItem(uid + property));
                if (localStorage.getItem(uid + property) != null && JSON.parse(localStorage.getItem(uid + property)) != null) {
                    //console.log("in if: fetched from local");
                    return JSON.parse(localStorage.getItem(uid + property));
                }
                else {
                    return null;
                }
            },

            setproperty: function (uid, data, property) {
                if (typeof data == 'string' && data != null) {
                    localStorage.setItem(uid + property, data);
                } else {
                    if (data != null) {
                        localStorage.setItem(uid + property, JSON.stringify(data));
                    }
                }
            },

            clearfacebook: function (uid) {
                localStorage.removeItem(uid + 'facebook_friends');

            }

        };

        function thisWeekDay(x) {
            var now = new Date();

            if (x == now.getDay()) {
                return now;
            }

            else if (x < now.getDay()) {
                now.setDate(now.getDate() - (now.getDay() - x));
                return now;
            }
            else if (x > now.getDay()) {
                now.setDate(now.getDate() + (x - now.getDay()));
                return now;
            }

        }
        uid = "";

        weektodays = {Sun: 0, Mon: 1, Tue: 2, Wed: 3, Thu: 4, Fri: 5, Sat: 6};
        function drawoncalendar(timetablesur, whose) {
            if (timetablesur != null && timetablesur.length > 0) {
                unitcolor = {};

                for (i = 0; i < timetablesur.length; i++) {
                    var cl = timetablesur[i];

                    var cld = cl.split("*");
                    //////console.log(cld);
                    var day = cld[2];
                    var time = cld[3];
                    var hour = time.split(":")[0];
                    var min = time.split(":")[1];

//                        createEventCalendarWithTime(color, start, end, title, duration)

                    var weektoday = {Sun: 0, Mon: 1, Tue: 2, Wed: 3, Thu: 4, Fri: 5, Sat: 6};
                    ////////console.log(thisWeekDay(weektoday[day]));
                    var start = thisWeekDay(weektoday[day]);
                    ////////console.log(start);
                    start.setHours(hour);
                    start.setMinutes(min);
                    start.setSeconds(0);

                    var unit = cld[0];
                    if (unitcolor['friendstatic'] == null) {
                        unitcolor['friendstatic'] = getRandomColor();
                    }
                    if (whose == "my") {
                        //////////console.log(unit, unitcolor);
                        if (unitcolor[unit] == null) {
                            unitcolor[unit] = getRandomColor();
                        }


                        createEventCalendarWithTime(unitcolor[unit], start, "---", cld[0], cld[5], timetablesur[i]);
                    } else {
                        createEventCalendarWithTime(unitcolor['friendstatic'], start, null, cld[0], cld[5], timetablesur[i]);
                    }

                }
            } else if (whose == 'friend' && timetablesur == null) {
                alert("Your friend hasn't uploaded their timetable");

            } else {

                loading = document.getElementById("timetableuploadtab");
                loading.style.visibility = "visible";

                document.getElementById("calendarviewtab").style.display = "none";
                document.getElementById("listviewtab").style.display = "none";

                addfilelist();
                //no timetable exists.

                $('ul.tabs').tabs('select_tab', 'timetableupload');

            }

        }
        function WriteText(message, data) {
            message.innerHTML = data;
        }
        initApp = function () {
            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {



                    ////////////console.log(user);
//                    ShowSomething(document.getElementById("logincomponents"));
//                    loading.style.visibility = "visible";
                    //HideSomething(document.getElementById("firebaseui-auth-container"));
//                    loading.style.display = "none";


                    var displayName = user.displayName;
                    var email = user.email;
                    var emailVerified = user.emailVerified;
                    var photoURL = user.photoURL;
                    uid = user.uid;


                    ////////////console.log(displayName+email+emailVerified+photoURL+uid);
                    user.getIdToken().then(function (accessToken) {

                        uid = user.uid;

                        firebase.database().ref('users/' + uid + "/email").set(email);
                        firebase.database().ref('users/' + uid + "/display_name").set(displayName);
                        firebase.database().ref("id_to_name/" + uid).set(displayName);

                        document.getElementById('useremail').innerHTML = email;
                        document.getElementById('userdisplayname').innerHTML = displayName;

                    });

                    ShowFbFriend();

                    //console.log(getdata.isaproperty(uid, "classes"));
                    var message = document.getElementById('importantmessage');
                    var alllogin = document.getElementById('logincomponents');
                    if (getdata.isaproperty(uid, "classes")) {

                        //console.log("No data available locally");
                        //check requests tree.. set up an event listener
                        //TODO If data exists in local storage
                        var starCountRef = firebase.database().ref('requests/' + uid + '/status');
                        starCountRef.on('value', function (snapshot) {
                            var a = snapshot.val();
                            //console.log(a);

                            if (a == null) { //upload,download,success,error
                                ShowSomething(document.getElementById("logincomponents"));
                                drawoncalendar(null, "my");
                            } else if (a != null && a.indexOf("ERR") != -1) {
                                alert("Error: Contact Us \n" + a);
                                ShowSomething(document.getElementById("logincomponents"));
                                ShowSomething(message);
                                WriteText(message, "Error occured while processing your timetable, contact us.");
                                drawoncalendar(null, "my");

                            }
                            else if (a == "UPLOAD") {
                                alert("Uploaded successfully");
                                HideSomething(alllogin);
                                ShowSomething(message);
                                WriteText(message, "Uploaded successfully, will be processed soon.");

                                //TODO add hiding all tabs code
                            }
                            else if (a == "DOWNLOADED") {
                                alert("Your file is currently being proccessed!");
                                HideSomething(alllogin);
                                ShowSomething(message);
                                WriteText(message, "Your file is being processed right now, hang tight..");

                            }
                            else if (a == "SUCCESS") {
                                timetablesur = getdata.getdatafromdb(uid, "classes");
                                /*ShowSomething(alllogin);
                                HideSomething(message);

                                ShowSomething(document.getElementById("calendarviewtab"));
                                ShowSomething(document.getElementById("listviewtab"));

                                $('ul.tabs').tabs('select_tab', 'calendarviewtab');*/
//                                //console.log(timetablesur);
//                                drawoncalendar(timetablesur, "my");
//                                alert("You're now on your way!");
                                //check if data exist -> localstorage
                            }
//                        alert(snapshot.val());
                        });
                    } else {
                        //JUST LOAD DATA from localstorage.
                        //console.log("Data available locally");


                        ShowSomething(alllogin);
                        ShowSomething(document.getElementById('calendar'));
                        HideSomething(message);

                        ShowSomething(document.getElementById("calendarviewtab"));
                        ShowSomething(document.getElementById("listviewtab"));
                        ShowSomething(document.getElementById('calendar'));

                        timetablesur = getdata.getproperty(uid, "classes");
                        drawoncalendar(timetablesur, "my");

                        $('ul.tabs').tabs('select_tab', 'calendarviewtab');
                    }
//
//
//                    timetablesur = getdata.getproperty(uid, "classes");
//
//                    if (timetablesur === undefined) {
//                        timetablesur = getdata.getproperty(uid, "classes");
//                    } else {
//
//                        drawoncalendar(timetablesur, "my");
//                    }
//
//                    if (timetablesur == undefined) {
//                        drawoncalendar(timetablesur, "my");
//                    }
//                    //console.log(timetablesur);


                    /*//console.log(timetablesur);
                     if(timetablesur===undefined){
                     //Error
                     }else {
                     ////console.log(timetablesur);
                     drawoncalendar(timetablesur, "my");
                     }*/
                    /*var starCountRef = firebase.database().ref('users/' + uid + '/classes/');
                     starCountRef.once('value').then(function (snapshot) {

                     timetablesur = snapshot.val();
                     drawoncalendar(timetablesur, "my");

                     });*/


                } else {


                    loading = document.getElementById("logincomponents");
                    loading.style.display = "none";
                    loading = document.getElementById("firebaseui-auth-container");
                    loading.style.display = "block";


                    document.getElementById('useremail').innerHTML = "";
                    document.getElementById('userdisplayname').innerHTML = "";

                }
            }, function (error) {

            });
        };
        window.addEventListener('load', function () {
            initApp()
        });


    </script>


    <script>

        function drawFriendOnCalendar(fuid) {
            toggleload();
            var starCountRef = firebase.database().ref('facebook_to_id/' + fuid);
            starCountRef.once('value').then(function (snapshot) {

                var uid_fb_friend = snapshot.val();

                var starCountRef = firebase.database().ref('users/' + uid_fb_friend + '/classes/');
                starCountRef.once('value').then(function (snapshot) {


                    var friend_tt = snapshot.val();

                    toggleload();

                    console.log("/users/" + uid_fb_friend + "/viewedby/" + uid);
                    firebase.database().ref("/users/" + uid_fb_friend + "/viewedby/" + uid).set({time: new Date().toJSON()});

                    drawoncalendar(friend_tt, "friend");

                });

            });
        }

        function elementin(l, e) {
            var found = false;
            for (i = 0; i < l.length; i++) {
                if (l[i] === e) {
                    return true;
                }
            }
            return found;
        }
        function getnondup(units, timetablesur) {
            var o = [];
            for (i = 0; i < units.length; i++) {
                ////console.log(!elementin(timetablesur, units[i]));
                if (!elementin(timetablesur, units[i])) {
                    o.push(units[i]);
                    ////console.log(o);
                }
            }
            ////console.log(o);
            return o;
        }

        function showInfoModal(currentevent) {

            //only show the swaps where teh user is not enrolled in
            var data = currentevent.data.split("*");

            currentclassselected = currentevent;
            var unit = data[0];
            var type = data[1].replace(/[0-9]/g, '');

            var starCountRef = firebase.database().ref('seperate_unit_list/' + unit + "/" + type);
            starCountRef.once('value').then(function (snapshot) {

                var units = snapshot.val();

                if(units!=null) {
                    var i = units.indexOf(currentevent.data);
                    units.splice(i, 1);
                }

                ////console.log(units);


                var o = units;


                $("#dropdownofswapspossible").innerHTML = "";

                if (o!= null && o.length > 0) {
                    var a = "";
                    for (i = 0; i < o.length; i++) {

                        if (!elementin(timetablesur, o[i])) {

                            var unitd = o[i].split("*");
                            ////console.log(unitd);
                            a += ("<option value='" + units[i] + "'>" + unitd[2] + " " + unitd[3] + "</option>");
                        }
                    }
                    $('select').material_select('destroy');
                    if (a != "") {
                        $("#dropdownofswapspossible").html(a);
                    }
                    else {
                        $("#dropdownofswapspossible").html("<option disabled >No swaps available</option>");
                    }

                } else {
                    //no swapping times avaiblae now
                    $("#dropdownofswapspossible").html("<option disabled >No swaps available</option>");
                }

                $('select').material_select();


            });

//            TODO: my fb friends to user id data must be stored.

            processedfbfriends = {};



            var mates = currentevent.data;

            var starCountRef = firebase.database().ref('classes/' + mates + '/users/');
            starCountRef.once('value').then(function (snapshot) {

                var mates = snapshot.val();

                if (mates.length >= 1) {

                    $("#other_class_friends").html("<p></p>");

                    for (i = 0; i < mates.length; i++) {
                        //get name and append it..

                        //TODO find an effective way of storing thses.

                    }
                    ////console.log(listoffriendsinclass);


                } else {
                    //No one else in the class..
                }
            });


            //get possible swaps


            $('#moreinfodialog').modal('open');


        }
        $(document).ready(function () {
            $('.button-collapse').sideNav({
                    menuWidth: 230,
                    draggable: true// Default is 240
//                        closeOnClick: true // Closes side-nav on <a> clicks, useful for Angular/Meteor
                }
            );
            $('.collapsible').collapsible();
            $('select').material_select();

            $('.modal').modal({
                    dismissible: true, // Modal can be dismissed by clicking outside of the modal
                    opacity: .99, // Opacity of modal background
                    inDuration: 300, // Transition in duration
                    outDuration: 200, // Transition out duration
                    startingTop: '4%', // Starting top style attribute
                    endingTop: '10%', // Ending top style attribute
                    ready: function (modal, trigger) { // Callback for Modal open. Modal and trigger parameters available.

                    },
                    complete: function () {
                    } // Callback for Modal close
                }
            );


            try {

                calendar = $('#calendar');
                //console.log(calendar);
                calendar.fullCalendar({
                    editable: false,
                    handleWindowResize: true,
                    weekends: false, // Hide weekends
                    defaultView: 'agendaWeek', // Only show week view
//                    height: 700,
                    contentHeight: 'auto',
                    header: false,   // Hide buttons/titles
                    minTime: '08:00:00', // Start time for the calendar
                    maxTime: '21:00:00', // End time for the calendar
                    columnFormat: {
                        week: 'ddd' // Only show day of the week names
                    },
                    allDaySlot: false,
                    displayEventTime: true,
                    eventClick: function (event) {
//                        ////////////console.log(event);

                        if (event.e != null) {

                            document.getElementById('eventdescription').innerHTML = event.description;
                            document.getElementById('eventtime').innerHTML = event.start._d;

                            ////console.log(event.data);


                            currentevent = event;
                            showInfoModal(currentevent);
                        }


                    }
//                allDayText: 'Online/TBD'
                });
            } catch (err) {
                //
                //console.log(err);
            }

        });

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        function createEventCalendar(color) {
            try {
                newEvent = {};
                newEvent.title = "Hello";
                newEvent.description = "Hello world this is my unit";


                var d = new Date();
                x = getRandomInt(8, 18);
                d.setHours(x);
                newEvent.start = d;
                newEvent.end = new Date(newEvent.start + (60 * 60 * 1000));
                newEvent.allDay = false;
                newEvent.color = getRandomColor();
                newEvent.duration = "duration";
                $('#calendar').fullCalendar('renderEvent', newEvent, 'stick');
            } catch (err) {

            }
        }
        function createEventCalendarWithTime(color, start, e, title, duration, data) {
            try {
                newEvent = {};
                newEvent.title = title;
                newEvent.description = "";

                newEvent.start = start;

                duration = duration.replace("~", ".");
                newEvent.end = new Date(start.getTime() + (duration * 60 * 60 * 1000));
                newEvent.allDay = false;
                newEvent.color = color;
                newEvent.data = data;
                newEvent.e = e; //TODO add disable fb friends click on calendar.
                $('#calendar').fullCalendar('renderEvent', newEvent, 'stick');
            } catch (err) {

            }
        }
        function getRandomColor() {

            var letters = '0123456789ABCDEF';
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
            /*
             var cols = ['FFF07C', 'D99AC5', 'F7C59F', 'D6E681', 'C4E7D4', '00A878', '52D1DC', 'DDC4DD', '824C71', '8E9AAF', '6369D1', '4E598C']
             return "#" + cols[getRandomInt(0, cols.length - 1)];
             */
        }


    </script>

    <style>
        header, main, footer {
            padding-left: 230px;
        }

        @media only screen and (max-width: 992px) {
            header, main, footer {
                padding-left: 0;
            }
        }

        .fc-today {
            opacity: 0;
            border: none;
        }

        .opaque {
            opacity: 0.15;
        }

    </style>

</head>
<body>

<div id="fb-root"></div>
<script>
    function logoff() {
        firebase.auth().signOut();
    }

    function ShowFbFriend() {

        response = getdata.getfacebook(uid);

        console.log(response);

        myfbfriends = {};

        if (response != null) {

            for (i = 0; i < response.length; i++) {
                myfbfriends[response[i].id] = response[i].name;
            }
        }

        for (var id in myfbfriends) {
            idtofidlookup = getdata.getproperty(uid, 'idtofid');
        }


        console.log(myfbfriends);


        autocompletefbdata = {};
        if (response != null) {
            try {
                for (i = 0; i < response.length; i++) {

                    autocompletefbdata[response[i].name] = null;
                    ////////console.log(response[i]);
                    $("#listfacebookfriends").append("<li onclick='drawFriendOnCalendar(" + response[i].id + ")' class='collection-item'><div>" + response[i].name + "</div>" + "</li>");
                }
            } catch (err) {
            }
        } else {
            //show the fb button...
        }


        $('#autocomplete-input-1').autocomplete({
            data: autocompletefbdata,
            limit: 20,
            onAutocomplete: function (val) {
                alert("Compare with " + val + "?");



            },
            minLength: 1, // The minimum length of the input for the autocomplete to start. Default: 1.
        });

    }

    function HideSomething(a) {
        a.style.display = "none";
    }
    function ShowSomething(a) {
        a.style.display = "block";
        a.style.visibility = "visible";
    }
    function sendClassSwapPref() {

        var a = $('option:selected').val();

        var aa = null;
        if (a != null) {
            aa = a.split("*");

            var unit = aa[0];
            var type = aa[1].replace(/[0-9]/g, '');

            var x = [currentclassselected.data, a];
            //console.log(x);
            firebase.database().ref('swaps/' + unit + "/" + type + "/" + uid).set(x);


        }

//        currentclassselected

    }

    function LoadFBUI() {

        FB.login(function (response) {

            if (response.authResponse) {

                fuid = response.authResponse.userID;

                firebase.database().ref('facebook_to_id/' + fuid).set(uid);
                firebase.database().ref('id_to_facebook/' + uid).set(fuid);

                //TODO add unique code calendar use.

                FB.api(
                    "/me/friends",
                    function (response) {
                        ////////////console.log(response);
                        if (response && !response.error) {

                            getdata.setfacebook(uid, response.data);


                            firebase.database().ref("/users/" + uid + "/facebook_friends").set(response.data);

                            ShowFbFriend();


                        }
                    }
                );
            }
        }, {scope: 'email, user_friends'});
    }
    window.fbAsyncInit = function () {
        FB.init({
            appId: '1913393705562842',
            cookie: true,
            xfbml: true,
            version: 'v2.8'
        });
        FB.AppEvents.logPageView();

    };
    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {
            return;
        }
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    function checkLoginState() {
        FB.getLoginStatus(function (response) {
        });
    }
    uid = 0;


</script>


<header>
    <nav class="blue">

        <ul id="slide-out" class="side-nav fixed">
            <li>
                <div class="userView">


                    <a href="#!user"><img id="profileimage" class="circle" src="profilepicdefault.png"></a>
                    <a href="#!name"><span id="userdisplayname" class="black-text name">  </span></a>
                    <a href="#!email"><span id="useremail" class="black-text email"
                                            style="font-size: 0.8em">  </span></a>

                </div>
            </li>

            <script>
                $(document).ready(function () {
                    $('.modal').modal();
                });

                function showPreviousViews() {


                    var starCountRef = firebase.database().ref('users/' + uid + '/viewedby/');
                    starCountRef.once('value').then(function (snapshot) {

                        console.log(a);
                        var a = snapshot.val();
                        for (var each in a) {
                            $('#viewing_recent').append("<tr><td>" + each + "</td><td>" + a[each].time + "</td></tr>");
                        }
                    });

                    $('#modalsrs').modal('open');


                }

            </script>


            <li><a class="subheader">Actions</a></li>

            <li><a href="#"><i class="material-icons">create</i>Edit</a></li>
            <li><a href="#"><i class="material-icons">settings</i>Preferences</a></li>
            <li><a href="#modalsrs"><i class="material-icons">drafts</i>Contact Us</a></li>

            <li><a onclick="tour()" href="#"><i class="material-icons">help</i>Help</a></li>
            <li><a onclick="logoff()"><i class="material-icons">close</i>Log off</a></li>


        </ul>


        <div class="nav-wrapper">
            <a href="../" class="brand-logo center">LearnTogether</a>
            <ul class="show-on-med-and-down">
                <li><a href="#" data-activates="slide-out" class="button-collapse"><i
                        class="material-icons right">menu</i></a></li>
            </ul>

            <ul class="right hide-on-med-and-down">
                <!--<li><a href="sass.html"><i class="material-icons">remove_red_eye</i></a></li>-->
                <li><a onclick="showPreviousViews()" href="#"><i class="material-icons">view_module</i></a></li>
                <!--<li><a href="collapsible.html"><i class="material-icons">refresh</i></a></li>
                <li><a href="mobile.html"><i class="material-icons">more_vert</i></a></li>-->
            </ul>


        </div>

    </nav>
</header>


<main>


    <h4 id="importantmessage" style="display: none">Hello</h4>
    <h4 style="display: none" id="firebaseui-auth-container" class="center"><a href="../home.html">Login</a></h4>


    <div class="row" id="logincomponents" style="visibility: hidden; padding-bottom: 80px;">


        <div class="col s12 m12  l8 x8">


            <p>My calendar can be accessed by unique code <a onclick="createEventCalendar('red')"><strong>A352J</strong></a>
            </p>


            <ul id="tabs-swipe-demo" class="tabs">
                <li class="tab col l3 s4"><a class="active" href="#calendarview" id="calendarviewtab">Calendar View</a>
                </li>
                <li class="tab col l3 s4"><a href="#tableview" id="listviewtab">List View</a></li>
                <li style="visibility: hidden" class="tab col l3 s4"><a href="#timetableupload" id="timetableuploadtab">Timetable
                    Upload</a></li>
            </ul>


                <br>

                <div class="col s12" id="calendarview">

                    <div class="col l12 s12 ">
                        <div id='calendar'></div>
                        <div class="row valign-wrapper">
                            <div class="col valign-wrapper s10">
                                <div class="fb-share-button" style="padding: 10px;"
                                     data-href="https://learntog.github.io/"
                                     data-layout="button_count" data-size="large" data-mobile-iframe="true"><a
                                        class="fb-xfbml-parse-ignore" target="_blank"
                                        href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Flearntog.github.io%2F&amp;src=sdkpreparse">Share</a>
                                </div>
                                <div class="fb-send" data-href="https://learntog.github.io/"></div>
                            </div>
                            <div class="col s2">

                            </div>

                        </div>

                    </div>
                    <div class="col l12 s12 center">

                        <!--add calendar control here-->


                    </div>


                </div>


                <script>
                    $(document).ready(function () {
                        $('.collapsible').collapsible();
                    });

                </script>


                <div id="tableview" class="col s12 transparent">
                    <b>Click on the class to get details</b>
                    <br>
                    <br>
                    <ul class="collapsible popout" data-collapsible="accordion">
                        <li>
                            <div class="collapsible-header">FIT1045 - Lab</div>
                            <div class="collapsible-body"><span> <b>Location</b> <br>Thursday 6-8pm, 16 Rainforest Walk <br><br> <b>Peers:</b> <br> Ishan, Arni.. </span>
                            </div>
                        </li>
                        <li>
                            <div class="collapsible-header">FIT1047 - Lab</div>
                            <div class="collapsible-body"><span> <b>Location</b> <br>Thursday 6-8pm, 25 Exhibition Walk <br><br> <b>Peers:</b> <br> Ishan, Arni.. </span>
                            </div>
                        </li>
                    </ul>
                </div>


            <div class="col s12 " id="timetableupload">


                <div class="progress">
                    <div id="progressbarupload" class="determinate" style="width: 0%"></div>
                </div>

                <script>
                    function addfilelist() {
                        var dropZone = document.getElementById('dropZone');

                        // Optional.   Show the copy icon when dragging over.  Seems to only work for chrome.
                        dropZone.addEventListener('dragover', function (e) {
                            e.stopPropagation();
                            e.preventDefault();
                            e.dataTransfer.dropEffect = 'copy';
                        });

                        function upload(file) {
                            if (file.size < 2000000) {
                                var storageRef = firebase.storage().ref();
                                var mountainImagesRef = storageRef.child('usertimetable/' + uid);
                                /*mountainImagesRef.put(file).then(function (snapshot) {
                                 //////console.log('Uploaded a blob or file!');
                                 });*/
                                task = mountainImagesRef.put(file);
                                task.on('state_changed', function (snapshot) {
                                    // Observe state change events such as progress, pause, and resume
                                    // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
                                    var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                                    document.getElementById('progressbarupload').style.width = "" + progress + '%';
                                    //////console.log('Upload is ' + progress + '% done');
                                    switch (snapshot.state) {
                                        case firebase.storage.TaskState.PAUSED: // or 'paused'
                                            //////console.log('Upload is paused');
                                            break;
                                        case firebase.storage.TaskState.RUNNING: // or 'running'
                                            //////console.log('Upload is running');
                                            break;
                                    }
                                }, function (error) {
                                    // Handle unsuccessful uploads
                                }, function () {
                                    // Handle successful uploads on complete
                                    // For instance, get the download URL: https://firebasestorage.googleapis.com/...
                                    var downloadURL = task.snapshot.downloadURL;
                                    //////console.log(downloadURL);
                                    //////console.log("Uploaded successfully. ");

                                    firebase.database().ref('requests/' + uid + "").set({status: "UPLOAD"});

                                });
                            } else {
                                alert("Too big..");
                            }
                        }

                        var fileInput = document.getElementById('fileInput');
                        fileInput.addEventListener('change', function (e) {
                            var file = fileInput.files[0];
                            upload(file);

                        });

                        // Get file data on drop
                        dropZone.addEventListener('drop', function (e) {
                            e.stopPropagation();
                            e.preventDefault();
                            var files = e.dataTransfer.files; // Array of all files

                            if (files.length == 1) {
                                var file = files[0];


                                if (file.size < 2000000) {
                                    upload(file);
                                } else {
                                    alert("File too big, contact us.");
                                }
                            } else {
                                alert("Select one file only");
                            }
                        });
                    }

                </script>


                <h3>We need your timetable!</h3>
                <div id="dropZone" style="padding-bottom: 150px; border: solid 2px black" class="center col l12 s12 ">

                    <img class="materialboxed" width="100%" src="allocatehelp.png">
                    <!--<img class="materialboxed" style="width: 100%" src="background.jpg">-->

                    <!---->

                    <br><br><br><br><br>
                    <input id="fileInput" class="center" size="60" style="opacity: 0.4;" type="file">
                    <br><br><br><br>
                    <p><strong>Or drag and drop here</strong></p>


                </div>


            </div>


            <a href="#moreinfodialog"></a>


            <div id="moreinfodialog" class="modal modal-fixed-footer">
                <div class="modal-content">

                    <h5>Activity Details</h5>

                    <div class="row">
                        <div class="col s12 m7 l7 x7">
                            <!--The class control-->
                            <p id="eventdescription">Description</p>
                            <p id="eventtime">Time</p>

                            <div class="input-field col s12">
                                <select id="dropdownofswapspossible">
                                </select>
                                <label>Swap it.</label>

                            </div>

                            <a onclick="sendClassSwapPref()">Save preferences</a>

                            <br><br>

                            <a class="tooltipped" data-position="right" data-delay="50" data-tooltip="Coming soon">Make
                                Notes Together</a>

                        </div>
                        <div class="col s12 m5 l5 x5">
                            <!--friend display and search-->
                            <div class="col s12">
                                <div class="row">
                                    <div class="input-field col s12">
                                        <i class="material-icons prefix">search</i>
                                        <input type="text" id="autocomplete_inp" class="autocomplete">
                                        <label for="autocomplete_inp">Search</label>
                                    </div>
                                </div>
                            </div>

                            <ul id="class_fb_friends" class="collection with-header">
                                <li class="collection-header"><h5>Facebook Friends</h5></li>
                                <li class="collection-item">
                                    <div>No one you know, make new friends?</div>
                                </li>

                            </ul>
                            <ul id="other_class_friends" class="collection with-header">

                            </ul>
                        </div>
                    </div>


                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-action modal-close waves-effect btn-flat">Close</a>
                </div>
            </div>
        </div>


        <div class="col s12 m12 l4 x4">
            <br>


            <div class="row">
                <div class="col s12">
                    <div class="row">
                        <div class="input-field col s12">
                            <i class="material-icons prefix">search</i>
                            <input type="text" id="autocomplete-input-1" class="autocomplete">
                            <label for="autocomplete-input-1">Search</label>
                        </div>
                    </div>
                </div>
                <div style="padding-bottom: 80px;" class="col s10 offset-s1">


                    <ul id="listfacebookfriends" style=" overflow-y: auto; max-height: 600px;"
                        class="collection with-header">
                        <li class="collection-header"><a><h6 onclick="LoadFBUI()">Connect to facebook</h6></a>

                        </li>


                    </ul>
                    <ul id="otheraddedfriends" style="max-height: 250px;" class="collection with-header">
                        <li class="collection-header"><h6><a href="#modal1">Other friends</a></h6>


                        </li>


                    </ul>


                </div>
            </div>
        </div>

    </div>

</main>


<div id="modal1" class="modal">
    <div class="modal-content">
        <h4>Add A Friend</h4>
        <div class="row">
            <form class="col s12">
                <div class="row">
                    <div class="input-field col s12">
                        <input style="text-transform: uppercase" id="input_text" type="text">
                        <label for="input_text">Unique Code</label>
                    </div>


                </div>

                <a class="btn waves-effect waves-light">Add</a>

            </form>
        </div>
    </div>


</div>
<div id="modalsrs" class="modal">
    <div class="modal-content">
        <h4>Recently viewed</h4>
        <table id="viewing_recent">
            <thead>
            <tr>
                <td>Who</td>
                <td>When</td>
            </tr>
            </thead>
        </table>

    </div>

</div>

<script src="https://www.gstatic.com/firebasejs/4.1.1/firebase.js"></script>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyBLA6sDqXwnMX6tJayM4dmYCPRzt5CW91M",
        authDomain: "learntogether-a250b.firebaseapp.com",
        databaseURL: "https://learntogether-a250b.firebaseio.com",
        projectId: "learntogether-a250b",
        storageBucket: "learntogether-a250b.appspot.com",
        messagingSenderId: "3175571907"
    };
    firebase.initializeApp(config);
</script>

</body>
</html>
